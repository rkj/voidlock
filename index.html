<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Xenopurge Prototype</title>
    <style>
      body { margin: 0; overflow: hidden; background-color: #1a1a1a; color: #eee; font-family: 'Courier New', Courier, monospace; }
      #app { width: 100vw; height: 100vh; position: relative; }
      
      /* Screens */
      .screen { 
        width: 100%; height: 100%; 
        display: none; /* Hidden by default */
        flex-direction: column; 
        background-color: #111;
      }
      
      /* Centered Screens (Menu, Setup) */
      .screen-centered {
        align-items: center;
        justify-content: center;
        text-align: center;
      }

      /* Screen: Mission (Game) */
      #screen-mission {
        display: none; /* Hidden initially */
        flex-direction: row;
      }

      #game-container { flex-grow: 1; display: flex; justify-content: center; align-items: center; position: relative; overflow: hidden; background-color: #000; }
      canvas { box-shadow: 0 0 20px rgba(0,0,0,0.5); max-width: 100%; max-height: 100%; object-fit: contain; }
      
      #ui-panel { width: 300px; flex-shrink: 0; padding: 10px; background-color: #222; border-left: 1px solid #444; overflow-y: auto; display: flex; flex-direction: column; }
      
      h1 { color: #0f0; text-shadow: 0 0 5px #0f0; font-size: 2em; margin-bottom: 20px; }
      h2 { color: #ccc; border-bottom: 1px solid #444; padding-bottom: 5px; width: 100%; margin-bottom: 15px; }
      h3 { color: #0f0; font-size: 1.1em; margin: 10px 0; }

      /* Buttons */
      button { background-color: #333; color: #0f0; border: 1px solid #0f0; padding: 10px 20px; cursor: pointer; margin-top: 5px; font-size: 1em; transition: all 0.2s; }
      button:hover { background-color: #0f0; color: #333; }
      button.active { background-color: #0f0; color: #333; font-weight: bold; }
      
      .menu-button { width: 300px; margin: 10px 0; font-size: 1.2em; }
      .back-button { margin-top: 20px; background-color: #442222; border-color: #ff4444; color: #ffcccc; }
      .back-button:hover { background-color: #ff4444; color: #000; }

      /* Controls */
      .control-group { margin-top: 15px; border-top: 1px solid #444; padding-top: 10px; text-align: left; width: 100%; max-width: 500px; }
      .mission-sidebar-group { margin-top: 15px; border-top: 1px solid #444; padding-top: 10px; }
      
      input[type="file"], input[type="text"], input[type="number"], select, textarea { 
        margin-top: 5px; color: #000; font-size: 0.9em; width: 100%; box-sizing: border-box; padding: 5px;
      }
      label { display: block; margin-top: 10px; color: #aaa; }
      
      /* Lists */
      #soldier-list { margin-top: 15px; flex-grow: 1; overflow-y: auto; border-top: 1px solid #444; padding-top: 10px; }
      .soldier-item { padding: 5px; border: 1px solid #333; margin-bottom: 5px; cursor: pointer; }
      .soldier-item:hover { background-color: #333; }
      .soldier-item.selected { border-color: #0f0; background-color: #222; }
      .soldier-item.dead { color: #f00; border-color: #f00; }
      .soldier-item.extracted { color: #0aa; border-color: #0aa; }
      
      .status-line { font-size: 0.8em; color: #aaa; }
      .hp-bar { height: 4px; background: #333; margin-top: 2px; }
      .hp-fill { height: 100%; background: #0f0; }
      
      #command-help { font-size: 0.8em; color: #888; margin-top: 10px; }
      
      /* Setup Screen Layout */
      #setup-content { display: flex; flex-direction: column; align-items: flex-start; width: 100%; max-width: 600px; padding: 20px; background: #1a1a1a; border: 1px solid #444; }
    </style>
  </head>
  <body>
    <div id="app">
      
      <!-- 1. Main Menu -->
      <div id="screen-main-menu" class="screen screen-centered">
        <h1>XENOPURGE</h1>
        <p>v0.1.0 Prototype</p>
        
        <div style="margin-top: 40px;">
          <button id="btn-menu-campaign" class="menu-button">Campaign (Coming Soon)</button><br>
          <button id="btn-menu-custom" class="menu-button">Custom Mission</button><br>
          <div style="margin-top: 20px; border-top: 1px solid #333; padding-top: 20px;">
             <label for="import-replay" style="cursor: pointer; display: inline-block; border: 1px solid #666; padding: 5px 10px;">Load Replay JSON</label>
             <input type="file" id="import-replay" accept=".json" style="display: none;" />
          </div>
        </div>
      </div>

      <!-- 2. Campaign Screen -->
      <div id="screen-campaign" class="screen screen-centered">
        <h1>CAMPAIGN</h1>
        <p>Mission list unavailable in prototype.</p>
        <button id="btn-campaign-back" class="back-button">Back to Menu</button>
      </div>

      <!-- 3. Mission Setup Screen -->
      <div id="screen-mission-setup" class="screen screen-centered">
        <h1>MISSION CONFIGURATION</h1>
        
        <div id="setup-content">
            <!-- Map Generation Controls moved here -->
            <div class="control-group">
              <h3>Map Generation</h3>
              <label for="map-generator-type">Generator Type:</label>
              <select id="map-generator-type">
                <option value="Procedural">Procedural Maze</option>
                <option value="Static">Static Map</option>
                <!-- TreeShip added via JS -->
              </select>

              <div id="preset-map-controls" style="margin-top: 10px;">
                <label for="preset-map-select">Preset Maps:</label>
                <select id="preset-map-select">
                  <option value="">-- Select a preset map --</option>
                  <option value="map-screenshot.json">Screenshot Map</option>
                </select>
                <button id="load-preset-map">Load Preset Map</button>
              </div>

              <label for="map-seed">Seed (optional):</label>
              <input type="number" id="map-seed" placeholder="Random" />
              <!-- Generate button logic will change to "Launch" -->

              <div id="static-map-controls" style="display: none; margin-top: 10px;">
                <label for="static-map-json">Static Map JSON (Paste below or Upload):</label>
                <textarea id="static-map-json" rows="5" style="width: 100%; box-sizing: border-box;"></textarea>
                <button id="load-static-map">Load Static JSON</button>
                <input type="file" id="upload-static-map" accept=".json" style="margin-top: 5px;">
                
                <label for="ascii-map-input" style="margin-top: 10px;">ASCII Map:</label>
                <textarea id="ascii-map-input" rows="5" style="width: 100%; box-sizing: border-box;"></textarea>
                <button id="convert-ascii-to-map">Convert ASCII to Map</button>
                <button id="convert-map-to-ascii">Convert Map to ASCII</button>
                
                <!-- Content Pack IO moved here? Or keep general -->
                <div id="content-pack-area"></div> 
              </div>
            </div>
            
            <!-- Squad Config Placeholder -->
            <div class="control-group">
                <h3>Squad</h3>
                <p>Default Squad: 1 Assault, 1 Medic</p>
                <!-- TODO: Squad Builder UI -->
            </div>

            <div style="margin-top: 30px; width: 100%; display: flex; justify-content: space-between;">
                <button id="btn-setup-back" class="back-button">Back</button>
                <button id="btn-launch-mission" style="font-size: 1.2em; padding: 15px 30px;">LAUNCH MISSION</button>
            </div>
        </div>
      </div>

      <!-- 4. Mission Screen (Game Loop) -->
      <div id="screen-mission" class="screen">
        <div id="game-container">
          <canvas id="game-canvas"></canvas>
        </div>
        <div id="ui-panel">
          <h3>MISSION CONTROL</h3>
          <p id="game-status">Status: Active</p>
          
          <div id="right-panel">
              <!-- Objectives, Threat Meter -->
          </div>

          <div id="soldier-list">
            <!-- Soldiers -->
          </div>

          <div class="mission-sidebar-group">
            <h3>Commands</h3>
            <button id="cmd-move">Move (M)</button>
            <div id="command-help">
              Select Command -> Select Unit -> Target
              <br>Shift+Click to Queue
            </div>
          </div>
          
          <div class="mission-sidebar-group">
            <h3>System</h3>
            <button id="export-replay">Export Replay</button>
            <button id="btn-mission-abort" class="back-button">Abort Mission</button>
          </div>
        </div>
      </div>

    </div>
    <script type="module" src="/src/renderer/main.ts"></script>
  </body>
</html>
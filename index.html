<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Xenopurge Prototype</title>
    <style>
      body {
        margin: 0;
        overflow: hidden;
        background-color: #1a1a1a;
        color: #eee;
        font-family: "Courier New", Courier, monospace;
      }
      #app {
        width: 100vw;
        height: 100vh;
        position: relative;
      }

      /* Screens */
      .screen {
        width: 100%;
        height: 100%;
        display: none; /* Hidden by default */
        flex-direction: column;
        background-color: #111;
      }

      /* Centered Screens (Menu, Setup) */
      .screen-centered {
        align-items: center;
        justify-content: center;
        text-align: center;
      }

      /* Screen: Mission (Game) */
      #screen-mission {
        display: none; /* Hidden initially */
        flex-direction: column;
      }

      #game-container {
        flex-grow: 1;
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
        overflow: hidden;
        background-color: #000;
      }
      canvas {
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
      }

      h1 {
        color: #0f0;
        text-shadow: 0 0 5px #0f0;
        font-size: 2em;
        margin-bottom: 20px;
      }
      h2 {
        color: #ccc;
        border-bottom: 1px solid #444;
        padding-bottom: 5px;
        width: 100%;
        margin-bottom: 15px;
      }
      h3 {
        color: #0f0;
        font-size: 1.1em;
        margin: 10px 0;
      }

      /* Buttons */
      button {
        background-color: #333;
        color: #0f0;
        border: 1px solid #0f0;
        padding: 10px 20px;
        cursor: pointer;
        margin-top: 5px;
        font-size: 1em;
        transition: all 0.2s;
      }
      button:hover {
        background-color: #0f0;
        color: #333;
      }
      button.active {
        background-color: #0f0;
        color: #333;
        font-weight: bold;
      }

      .menu-button {
        width: 300px;
        margin: 10px 0;
        font-size: 1.2em;
      }
      .back-button {
        margin-top: 20px;
        background-color: #442222;
        border-color: #ff4444;
        color: #ffcccc;
      }
      .back-button:hover {
        background-color: #ff4444;
        color: #000;
      }

      /* Controls */
      .control-group {
        margin-top: 15px;
        border-top: 1px solid #444;
        padding-top: 10px;
        text-align: left;
        width: 100%;
        max-width: 500px;
      }
      .mission-sidebar-group {
        margin-top: 15px;
        border-top: 1px solid #444;
        padding-top: 10px;
      }

      input[type="file"],
      input[type="text"],
      input[type="number"],
      select,
      textarea {
        margin-top: 5px;
        color: #000;
        font-size: 0.9em;
        width: 100%;
        box-sizing: border-box;
        padding: 5px;
      }
      label {
        display: block;
        margin-top: 10px;
        color: #aaa;
      }

      /* Lists */
      #soldier-list {
        width: 100%;
        display: flex;
        gap: 5px;
        height: 100%;
        justify-content: flex-start;
        flex-wrap: nowrap;
        overflow-x: auto;
      }
      .soldier-item {
        min-width: 220px;
        width: 220px;
        flex: 0 0 auto;
        height: 100%;
        border: 1px solid #333;
        cursor: pointer;
        background: #111;
        display: flex;
        flex-direction: column;
        padding: 2px 8px;
        box-sizing: border-box;
        overflow: hidden;
        transition: border-color 0.2s;
      }
      .soldier-item:hover {
        background-color: #1a1a1a;
      }
      .soldier-item.selected {
        border-color: #0f0;
        background-color: #1a1a1a;
      }
      .soldier-item.dead {
        color: #eee;
        background-color: #500;
        border-color: #f00;
        opacity: 0.9;
      }
      .soldier-item.extracted {
        color: #0aa;
        border-color: #0aa;
        opacity: 0.7;
      }

      .info-row {
        height: 20px;
        overflow: hidden;
        white-space: nowrap;
        margin-bottom: 0;
      }
      .u-id {
        color: #0f0;
        font-size: 1em;
      }
      .u-status {
        font-size: 0.8em;
        color: #aaa;
        margin-left: 10px;
        flex-grow: 1;
        text-align: right;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .hp-bar {
        height: 4px;
        background: #222;
        margin: 2px 0;
        border: 1px solid #444;
        width: 100%;
      }
      .hp-fill {
        height: 100%;
        background: #0f0;
        transition: width 0.3s ease-in-out;
      }

      .menu-item {
        border: 1px solid #444;
        padding: 5px 10px;
        margin-bottom: 5px;
      }
      .menu-item.clickable {
        cursor: pointer;
      }
      .menu-item.clickable:hover {
        background-color: #333;
        border-color: #0f0;
      }
      .menu-item.active {
        border-color: #0f0;
        background-color: #040;
      }
      .menu-item.disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .unit-commands {
        margin-top: auto;
        display: flex;
        gap: 5px;
      }
      .unit-commands button {
        padding: 5px 10px;
        font-size: 0.85em;
        flex: 1;
        margin: 0;
      }

      /* Setup Screen Layout */
      #setup-content {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        width: 100%;
        max-width: 600px;
        padding: 20px;
        background: #1a1a1a;
        border: 1px solid #444;
        max-height: 80vh;
        overflow-y: auto;
      }

      /* Campaign Map */
      .campaign-node:hover {
        transform: scale(1.2);
        z-index: 10 !important;
      }
      .campaign-node.accessible:hover {
        background-color: #444 !important;
        border-color: #0f0 !important;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <!-- 1. Main Menu -->
      <div id="screen-main-menu" class="screen screen-centered">
        <h1>XENOPURGE</h1>
        <p id="menu-version"></p>

        <div style="margin-top: 40px">
          <button id="btn-menu-campaign" class="menu-button">
            Campaign (Coming Soon)</button
          ><br />
          <button id="btn-menu-custom" class="menu-button">
            Custom Mission</button
          ><br />
          <div
            style="
              margin-top: 20px;
              border-top: 1px solid #333;
              padding-top: 20px;
            "
          >
            <label
              for="import-replay"
              style="
                cursor: pointer;
                display: inline-block;
                border: 1px solid #666;
                padding: 5px 10px;
              "
              >Load Replay JSON</label
            >
            <input
              type="file"
              id="import-replay"
              accept=".json"
              style="display: none"
            />
          </div>
        </div>
      </div>

      <!-- 2. Campaign Screen -->
      <div id="screen-campaign" class="screen screen-centered">
        <h1>CAMPAIGN</h1>
        <p>Mission list unavailable in prototype.</p>
        <button id="btn-campaign-back" class="back-button">Back to Menu</button>
      </div>

      <!-- 3. Mission Setup Screen -->
      <div id="screen-mission-setup" class="screen screen-centered">
        <h1>MISSION CONFIGURATION</h1>
        <div id="setup-content">
          <div class="control-group">
            <label for="map-generator-type">Generator Type:</label>
            <select id="map-generator-type">
              <option value="Procedural">Procedural</option>
              <option value="Static">Static Map</option>
            </select>
          </div>

          <div class="control-group">
            <div id="preset-map-controls">
              <label for="map-seed">Map Seed:</label>
              <input type="number" id="map-seed" placeholder="Random" />

              <div style="display: flex; gap: 10px">
                <div style="flex: 1">
                  <label for="map-width">Width:</label>
                  <input type="number" id="map-width" value="14" />
                </div>
                <div style="flex: 1">
                  <label for="map-height">Height:</label>
                  <input type="number" id="map-height" value="14" />
                </div>
              </div>

              <label for="map-spawn-points">Enemy Spawns:</label>
              <input
                type="number"
                id="map-spawn-points"
                value="1"
                min="1"
                max="10"
              />

              <label for="map-starting-threat"
                >Starting Threat:
                <span id="map-starting-threat-value">0</span>%</label
              >
              <input
                type="range"
                id="map-starting-threat"
                min="0"
                max="100"
                step="5"
                value="0"
              />
            </div>

            <div id="static-map-controls" style="display: none">
              <h3>Static Map</h3>
              <textarea
                id="static-map-json"
                rows="5"
                placeholder="Paste JSON MapDefinition here..."
              ></textarea>
              <button id="load-static-map">Load JSON</button>
              <input type="file" id="upload-static-map" accept=".json" />

              <h3 style="margin-top: 15px">ASCII Map</h3>
              <textarea
                id="ascii-map-input"
                rows="5"
                placeholder="Paste ASCII map here..."
              ></textarea>
              <button id="convert-ascii-to-map">Convert ASCII</button>
            </div>
          </div>

          <div class="control-group">
            <h3>Squad Selection</h3>
            <div id="squad-builder">
              <!-- Injected by JS -->
            </div>
          </div>

          <div
            style="
              margin-top: 30px;
              width: 100%;
              display: flex;
              justify-content: space-between;
            "
          >
            <button id="btn-setup-back" class="back-button">Back</button>
            <button
              id="btn-goto-equipment"
              style="font-size: 1.2em; padding: 15px 30px"
            >
              EQUIPMENT & supplies
            </button>
          </div>
        </div>
      </div>

      <!-- 3b. Equipment Screen -->
      <div id="screen-equipment" class="screen">
        <!-- Content will be injected by EquipmentScreen.ts -->
      </div>

      <!-- 4. Mission Screen (Game Loop) -->
      <div id="screen-mission" class="screen">
        <!-- 1. Top Bar -->
        <div
          id="top-bar"
          style="
            height: 40px;
            background: #222;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            border-bottom: 1px solid #444;
            flex-shrink: 0;
          "
        >
          <div id="game-status" style="font-weight: bold; color: #0f0">
            Status: Active
          </div>
          <div
            id="top-threat-container"
            style="
              display: flex;
              align-items: center;
              gap: 10px;
              flex-grow: 1;
              justify-content: center;
              max-width: 450px;
              margin: 0 20px;
            "
          >
            <span style="font-size: 0.8em; color: #aaa; white-space: nowrap"
              >THREAT:</span
            >
            <div
              id="top-threat-bar"
              style="
                width: 100%;
                background: #333;
                height: 12px;
                border: 1px solid #555;
                position: relative;
                overflow: hidden;
                box-sizing: border-box;
              "
            >
              <!-- Robust Flex-based Dividers every 10% -->
              <div
                style="
                  position: absolute;
                  inset: 0;
                  display: flex;
                  pointer-events: none;
                  z-index: 1;
                "
              >
                <div
                  style="
                    width: 10%;
                    height: 100%;
                    border-right: 1px solid #666;
                    box-sizing: border-box;
                  "
                ></div>
                <div
                  style="
                    width: 10%;
                    height: 100%;
                    border-right: 1px solid #666;
                    box-sizing: border-box;
                  "
                ></div>
                <div
                  style="
                    width: 10%;
                    height: 100%;
                    border-right: 1px solid #666;
                    box-sizing: border-box;
                  "
                ></div>
                <div
                  style="
                    width: 10%;
                    height: 100%;
                    border-right: 1px solid #666;
                    box-sizing: border-box;
                  "
                ></div>
                <div
                  style="
                    width: 10%;
                    height: 100%;
                    border-right: 1px solid #666;
                    box-sizing: border-box;
                  "
                ></div>
                <div
                  style="
                    width: 10%;
                    height: 100%;
                    border-right: 1px solid #666;
                    box-sizing: border-box;
                  "
                ></div>
                <div
                  style="
                    width: 10%;
                    height: 100%;
                    border-right: 1px solid #666;
                    box-sizing: border-box;
                  "
                ></div>
                <div
                  style="
                    width: 10%;
                    height: 100%;
                    border-right: 1px solid #666;
                    box-sizing: border-box;
                  "
                ></div>
                <div
                  style="
                    width: 10%;
                    height: 100%;
                    border-right: 1px solid #666;
                    box-sizing: border-box;
                  "
                ></div>
                <div
                  style="width: 10%; height: 100%; box-sizing: border-box"
                ></div>
              </div>
              <div
                id="top-threat-fill"
                style="
                  width: 0%;
                  background: #4caf50;
                  height: 100%;
                  position: relative;
                  z-index: 0;
                  transition:
                    width 0.5s,
                    background-color 0.5s;
                "
              ></div>
            </div>
            <span
              id="top-threat-value"
              style="font-size: 0.8em; color: #4caf50; min-width: 40px"
              >0%</span
            >
          </div>
          <div
            id="seed-display"
            style="color: #888; font-family: monospace; font-size: 0.85em"
          ></div>

          <!-- Speed Control -->
          <div
            id="speed-control"
            style="
              display: flex;
              align-items: center;
              gap: 5px;
              margin-left: 20px;
            "
          >
            <button
              id="btn-pause-toggle"
              style="
                margin: 0;
                padding: 2px 10px;
                min-width: 60px;
                font-size: 0.8em;
              "
            >
              ‚è∏ Pause
            </button>
            <label
              for="game-speed"
              style="font-size: 0.8em; color: #aaa; margin: 0"
              >Speed:</label
            >
            <input
              type="range"
              id="game-speed"
              min="0.1"
              max="5.0"
              step="0.1"
              value="1.0"
              style="width: 80px"
              title="Game Speed (1.0x default)"
            />
            <span
              id="speed-value"
              style="font-size: 0.8em; color: #aaa; min-width: 30px"
              >1.0x</span
            >
          </div>

          <div
            id="version-display"
            style="font-size: 0.8em; color: #888; margin-left: 20px"
          ></div>

          <button
            id="btn-give-up"
            style="
              margin-left: 10px;
              padding: 2px 10px;
              font-size: 0.8em;
              background-color: #442222;
              border-color: #ff4444;
              color: #ffcccc;
              white-space: nowrap;
            "
          >
            Give Up
          </button>
        </div>

        <!-- 2. Soldier Bar (RPG Style) -->
        <div
          id="soldier-panel"
          style="
            background: #111;
            border-bottom: 1px solid #444;
            padding: 2px 10px;
            overflow: hidden;
            flex-shrink: 0;
          "
        >
          <div id="soldier-list">
            <!-- Soldier cards injected here -->
          </div>
        </div>

        <!-- 3. Main Area -->
        <div
          id="mission-body"
          style="
            display: flex;
            flex-grow: 1;
            overflow: hidden;
            background: #000;
          "
        >
          <div
            id="game-container"
            style="
              flex-grow: 1;
              display: flex;
              justify-content: center;
              align-items: center;
              position: relative;
              overflow: auto;
            "
          >
            <canvas id="game-canvas"></canvas>
          </div>

          <div
            id="right-panel"
            style="
              width: 300px;
              background: #1a1a1a;
              border-left: 1px solid #444;
              padding: 10px;
              display: flex;
              flex-direction: column;
              overflow-y: auto;
              flex-shrink: 0;
            "
          >
            <!-- Commands and Objectives will be injected here -->
          </div>
        </div>
      </div>

      <!-- 5. Debrief Screen -->
      <div
        id="screen-debrief"
        class="screen"
        style="
          z-index: 1000;
          background: rgba(0, 0, 0, 0.8);
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
        "
      >
        <!-- Content will be injected by DebriefScreen.ts -->
      </div>
    </div>
    <script type="module" src="/src/renderer/main.ts"></script>
  </body>
</html>
